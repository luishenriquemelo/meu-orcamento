<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- ESTILOS (CSS) --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        :root {
            --purple: #6c63ff;
            --green: #2ecc71;
            --red: #e74c3c;
            --orange: #f39c12;
            --bg: #f0f2f5;
            --text: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { background-color: var(--bg); font-family: 'Poppins', sans-serif; color: var(--text); padding: 20px; }

        .container { width: 100%; max-width: 1100px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 25px; }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #fff; padding: 20px; border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center;
        }
        .money { font-size: 28px; font-weight: bold; margin: 10px 0; }
        .balance-card .money { color: var(--green); }
        .invoice-card .money { color: var(--orange); }

        /* Layout Principal */
        .main-content { display: flex; flex-wrap: wrap; gap: 20px; }
        .column { flex: 1; min-width: 320px; display: flex; flex-direction: column; gap: 20px; }

        .box-clean {
            background: #fff; padding: 20px; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .box-clean h3 { 
            border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;
            font-size: 16px; color: #555; display: flex; align-items: center; gap: 8px;
        }

        /* Formulários */
        .input-group-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .form-control { margin-bottom: 15px; }
        .form-control label { display: block; margin-bottom: 5px; font-size: 13px; color: #666; }
        
        input, select {
            border: 1px solid #ddd; border-radius: 8px; padding: 10px;
            width: 100%; font-family: inherit; font-size: 14px;
        }
        
        .row-inputs { display: flex; gap: 10px; }
        .half { flex: 1; }

        /* Botões */
        .btn-icon {
            background: var(--purple); color: #fff; border: none; width: 45px;
            border-radius: 8px; cursor: pointer; font-size: 16px;
        }
        .btn-save {
            width: 100%; background: var(--purple); color: #fff; border: none;
            padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600;
        }
        .btn-save:hover { background: #5a52d5; }

        /* Tags Categorias */
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        .tag {
            background: #f0f0f0; padding: 5px 10px; border-radius: 15px; font-size: 12px;
            display: flex; align-items: center; gap: 5px;
        }
        .tag-delete { cursor: pointer; color: var(--red); font-weight: bold; margin-left: 5px; }

        /* Radio Buttons */
        .radio-group { display: flex; gap: 10px; }
        .radio-group input { display: none; }
        .radio-label {
            flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            text-align: center; cursor: pointer; font-size: 13px; color: #777; transition: 0.2s;
        }
        input:checked + .radio-label {
            background-color: #eef; border-color: var(--purple); color: var(--purple); font-weight: 600;
        }

        /* Listas */
        ul { list-style: none; }
        .list li {
            background: #f9f9f9; padding: 10px; margin-bottom: 8px; border-radius: 6px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid #ccc;
        }
        .list li.income { border-left-color: var(--green); }
        .list li.expense-debit { border-left-color: #777; }
        .list li.expense-credit { border-left-color: var(--orange); }

        .badge-credit {
            background: var(--orange); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px;
        }
        .delete-btn {
            background: none; border: none; color: #ccc; cursor: pointer; margin-left: 10px;
        }
        .delete-btn:hover { color: var(--red); }
        
        .list-users li { 
            display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; 
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Gestão Financeira & Cartão</h1>
        </header>

        <div class="dashboard-grid">
            <div class="card balance-card">
                <h3><i class="fas fa-wallet"></i> Minha Carteira</h3>
                <p id="wallet-balance" class="money">R$ 0.00</p>
                <small>Saldo disponível (Débito/Dinheiro)</small>
            </div>
            <div class="card invoice-card">
                <h3><i class="fas fa-credit-card"></i> Fatura Atual</h3>
                <p id="invoice-total" class="money">R$ 0.00</p>
                <small>Acumulado no Cartão de Crédito</small>
            </div>
        </div>

        <div class="main-content">
            <div class="column">
                
                <div class="box-clean">
                    <h3><i class="fas fa-users"></i> Usuários do Cartão</h3>
                    <div class="input-group-row">
                        <input type="text" id="new-user-name" placeholder="Nome (Ex: Mãe)">
                        <button onclick="addUser()" class="btn-icon"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div class="box-clean">
                    <h3><i class="fas fa-tags"></i> Categorias</h3>
                    <div class="tags-container" id="categories-list"></div>
                    <div class="input-group-row">
                        <input type="text" id="new-category-name" placeholder="Nova (Ex: Uber)">
                        <button onclick="addCategory()" class="btn-icon"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div class="box-clean">
                    <h3>Nova Movimentação</h3>
                    <form id="transaction-form">
                        <div class="form-control">
                            <label>Descrição</label>
                            <input type="text" id="desc" placeholder="O que foi comprado?" required>
                        </div>
                        
                        <div class="row-inputs">
                            <div class="form-control half">
                                <label>Valor (R$)</label>
                                <input type="text" id="amount" placeholder="0,00" required> 
                            </div>
                            <div class="form-control half">
                                <label>Categoria</label>
                                <select id="category-select"></select>
                            </div>
                        </div>

                        <div class="row-inputs">
                            <div class="form-control half">
                                <label>Tipo</label>
                                <select id="trans-type">
                                    <option value="expense">Saída (-)</option>
                                    <option value="income">Entrada (+)</option>
                                </select>
                            </div>
                            <div class="form-control half">
                                <label>Responsável</label>
                                <select id="user-select" onchange="checkUserMethod()">
                                    <option value="Eu">Eu (Pessoal)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-control">
                            <label>Método de Pagamento</label>
                            <div class="radio-group">
                                <input type="radio" id="method-debit" name="method" value="debit" checked>
                                <label for="method-debit" class="radio-label"><i class="fas fa-money-bill-wave"></i> Débito/Pix</label>
                                
                                <input type="radio" id="method-credit" name="method" value="credit">
                                <label for="method-credit" class="radio-label"><i class="fas fa-credit-card"></i> Crédito</label>
                            </div>
                        </div>

                        <button type="submit" class="btn-save">Registrar</button>
                    </form>
                </div>
            </div>

            <div class="column">
                <div class="box-clean">
                    <h3><i class="fas fa-chart-pie"></i> Rateio da Fatura (Quem deve?)</h3>
                    <ul id="invoice-split-list" class="list-users"></ul>
                    <div style="text-align: right; margin-top:15px; color:#555;">
                        Minha parte na fatura: <strong id="my-invoice-part">R$ 0.00</strong>
                    </div>
                </div>

                <div class="box-clean">
                    <h3>Extrato</h3>
                    <ul id="transactions-list" class="list"></ul>
                </div>
                
                <button onclick="clearAll()" style="width:100%; padding:10px; background:#ddd; border:none; border-radius:5px; cursor:pointer;">Resetar Sistema (Limpar Tudo)</button>
            </div>
        </div>
    </div>

    <script>
        // Dados Iniciais
        let transactions = JSON.parse(localStorage.getItem('fin_transactions')) || [];
        let users = JSON.parse(localStorage.getItem('fin_users')) || [];
        let categories = JSON.parse(localStorage.getItem('fin_categories')) || ['Alimentação', 'Transporte', 'Lazer', 'Contas'];

        // Elementos
        const elWallet = document.getElementById('wallet-balance');
        const elInvoice = document.getElementById('invoice-total');
        const elMyPart = document.getElementById('my-invoice-part');
        const elList = document.getElementById('transactions-list');
        const elSplit = document.getElementById('invoice-split-list');
        const elUserSelect = document.getElementById('user-select');
        const elCatSelect = document.getElementById('category-select');
        const elCatList = document.getElementById('categories-list');

        // --- FUNÇÕES PRINCIPAIS ---

        function init() {
            updateDropdowns();
            updateScreen();
        }

        // Salvar Nova Transação
        document.getElementById('transaction-form').addEventListener('submit', function(e) {
            e.preventDefault(); // Impede recarregar a página

            const desc = document.getElementById('desc').value;
            let amountStr = document.getElementById('amount').value;
            
            // CORREÇÃO DE VÍRGULA: Troca vírgula por ponto para o computador entender
            amountStr = amountStr.replace(',', '.');
            const amount = parseFloat(amountStr);

            if (isNaN(amount) || amount <= 0) {
                alert("Por favor, digite um valor válido.");
                return;
            }

            const type = document.getElementById('trans-type').value;
            const user = document.getElementById('user-select').value;
            const category = document.getElementById('category-select').value;
            
            // Pega método (Radio Button)
            let method = 'debit';
            if(document.getElementById('method-credit').checked) method = 'credit';

            const transaction = {
                id: Date.now(),
                desc, amount, type, user, category, method,
                date: new Date().toLocaleDateString('pt-BR')
            };

            transactions.push(transaction);
            saveData();
            updateScreen();

            // Limpa campos
            document.getElementById('desc').value = '';
            document.getElementById('amount').value = '';
        });

        // Atualizar Tela e Cálculos
        function updateScreen() {
            elList.innerHTML = '';
            elSplit.innerHTML = '';

            let wallet = 0;
            let invoice = 0;
            let myInvoice = 0;
            let othersInvoice = {};
            users.forEach(u => othersInvoice[u] = 0);

            transactions.forEach(t => {
                // Adiciona na Lista Visual
                const li = document.createElement('li');
                li.className = t.type === 'income' ? 'income' : (t.method === 'credit' ? 'expense-credit' : 'expense-debit');
                
                const labelCredit = t.method === 'credit' ? '<span class="badge-credit">Crédito</span>' : '';
                const sign = t.type === 'expense' ? '-' : '+';

                li.innerHTML = `
                    <div>
                        <strong>${t.desc} ${labelCredit}</strong>
                        <small style="color:#777">${t.user} | ${t.category} | ${t.date}</small>
                    </div>
                    <div>
                        <span style="font-weight:bold">${sign} R$ ${t.amount.toFixed(2)}</span>
                        <button class="delete-btn" onclick="removeTrans(${t.id})">&times;</button>
                    </div>
                `;
                elList.prepend(li);

                // Cálculos
                if (t.type === 'income') {
                    wallet += t.amount;
                } else {
                    if (t.method === 'debit') {
                        wallet -= t.amount;
                    } else {
                        // É crédito
                        invoice += t.amount;
                        if(t.user === 'Eu') {
                            myInvoice += t.amount;
                        } else if (othersInvoice[t.user] !== undefined) {
                            othersInvoice[t.user] += t.amount;
                        }
                    }
                }
            });

            // Atualiza Totais
            elWallet.innerText = `R$ ${wallet.toFixed(2)}`;
            elInvoice.innerText = `R$ ${invoice.toFixed(2)}`;
            elMyPart.innerText = `R$ ${myInvoice.toFixed(2)}`;

            // Atualiza Rateio (Quem deve)
            for (const [name, val] of Object.entries(othersInvoice)) {
                if (val > 0) {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${name}</span> <strong>R$ ${val.toFixed(2)}</strong>`;
                    elSplit.appendChild(li);
                }
            }
        }

        // --- FUNÇÕES DE APOIO ---

        function checkUserMethod() {
            const u = elUserSelect.value;
            if(u !== 'Eu') {
                document.getElementById('method-credit').checked = true;
            }
        }

        function addUser() {
            const name = document.getElementById('new-user-name').value.trim();
            if(name && !users.includes(name)) {
                users.push(name);
                saveData();
                updateDropdowns();
                document.getElementById('new-user-name').value = '';
            }
        }

        function addCategory() {
            const name = document.getElementById('new-category-name').value.trim();
            if(name && !categories.includes(name)) {
                categories.push(name);
                saveData();
                updateDropdowns();
                document.getElementById('new-category-name').value = '';
            }
        }

        function removeCategory(name) {
            if(confirm('Excluir categoria?')) {
                categories = categories.filter(c => c !== name);
                saveData();
                updateDropdowns();
            }
        }

        function removeTrans(id) {
            if(confirm('Apagar transação?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                updateScreen();
            }
        }

        function updateDropdowns() {
            // Usuários
            elUserSelect.innerHTML = '<option value="Eu">Eu (Pessoal)</option>';
            users.forEach(u => {
                const opt = document.createElement('option');
                opt.value = u; opt.innerText = u;
                elUserSelect.appendChild(opt);
            });

            // Categorias Select
            elCatSelect.innerHTML = '';
            categories.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c; opt.innerText = c;
                elCatSelect.appendChild(opt);
            });

            // Categorias Tags
            elCatList.innerHTML = '';
            categories.forEach(c => {
                const div = document.createElement('div');
                div.className = 'tag';
                div.innerHTML = `${c} <span class="tag-delete" onclick="removeCategory('${c}')">&times;</span>`;
                elCatList.appendChild(div);
            });
        }

        function saveData() {
            localStorage.setItem('fin_transactions', JSON.stringify(transactions));
            localStorage.setItem('fin_users', JSON.stringify(users));
            localStorage.setItem('fin_categories', JSON.stringify(categories));
        }

        function clearAll() {
            if(confirm('Tem certeza? Isso apaga tudo para sempre.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Iniciar
        init();
    </script>
</body>
</html>