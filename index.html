<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro Cloud - Henrique</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* (MANTIVE O MESMO DESIGN BONITO DE ANTES) */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        :root { --purple: #6c63ff; --green: #2ecc71; --orange: #f39c12; --red: #e74c3c; --bg: #f0f2f5; --text: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { background-color: var(--bg); font-family: 'Poppins', sans-serif; color: var(--text); padding: 20px; }
        .container { width: 100%; max-width: 1000px; margin: 0 auto; }
        header { display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; gap: 10px; }
        .month-filter-container { background: #fff; padding: 10px 20px; border-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 10px; border: 2px solid var(--purple); }
        .month-filter-container input { border: none; font-size: 16px; font-weight: bold; color: #333; cursor: pointer; background: transparent; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; }
        .money { font-size: 28px; font-weight: bold; margin: 10px 0; }
        .balance-card .money { color: var(--green); }
        .invoice-card .money { color: var(--orange); }
        .main-content { display: flex; flex-wrap: wrap; gap: 20px; }
        .column { flex: 1; min-width: 320px; display: flex; flex-direction: column; gap: 20px; }
        .box-clean { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative;}
        .box-clean h3 { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px; font-size: 16px; color: #555; display: flex; align-items: center; gap: 8px; }
        .input-group-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .form-control { margin-bottom: 15px; }
        .form-control label { display: block; margin-bottom: 5px; font-size: 12px; color: #666; font-weight: 600; }
        input, select, textarea { border: 1px solid #ddd; border-radius: 8px; padding: 12px; width: 100%; font-family: inherit; font-size: 14px; }
        textarea { resize: vertical; }
        .row-inputs { display: flex; gap: 10px; }
        .half { flex: 1; }
        .btn-icon { background: var(--purple); color: #fff; border: none; width: 50px; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .btn-save { width: 100%; background: var(--purple); color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600; margin-top: 10px; }
        .btn-save:hover { background: #5a52d5; }
        .btn-cancel { width: 100%; background: #95a5a6; color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 600; margin-top: 10px; display: none; }
        .btn-action-group { display: flex; gap: 5px; }
        .btn-delete { color: #aaa; background: none; border: none; cursor: pointer; font-size: 14px; padding: 5px;}
        .btn-delete:hover { color: var(--red); }
        .btn-edit { color: #aaa; background: none; border: none; cursor: pointer; font-size: 14px; padding: 5px;}
        .btn-edit:hover { color: #3498db; }
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        .tag { background: #e3f2fd; color: #1565c0; padding: 5px 12px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 5px; border: 1px solid #bbdefb; cursor: pointer; transition: 0.2s; }
        .tag:hover { background: #bbdefb; }
        .tag-delete { cursor: pointer; color: var(--red); font-weight: bold; margin-left: 5px; padding-left: 5px; border-left: 1px solid rgba(0,0,0,0.1); }
        .radio-group { display: flex; gap: 10px; }
        .radio-group input { display: none; }
        .radio-label { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; font-size: 13px; color: #777; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        input:checked + .radio-label { background-color: #f3e5f5; border-color: var(--purple); color: var(--purple); font-weight: 600; }
        ul { list-style: none; }
        .list li { background: #f9f9f9; padding: 12px; margin-bottom: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; }
        .list li.income { border-left-color: var(--green); }
        .list li.expense-debit { border-left-color: #555; }
        .list li.expense-credit { border-left-color: var(--orange); }
        .badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: white;}
        .bg-credit { background-color: var(--orange); }
        .bg-debit { background-color: #777; }
        .obs-text { font-size: 11px; color: #777; margin-top: 3px; font-style: italic; display: block; }
        .bank-summary-item { flex-direction: column; align-items: flex-start; padding: 0; border-bottom: 1px solid #eee; margin-bottom: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-left: none; overflow: hidden; }
        .bank-header { display: flex; justify-content: space-between; width: 100%; font-size: 14px; font-weight: bold; color: #fff; padding: 10px 15px; }
        .bank-people-list { width: 100%; font-size: 13px; color: #555; padding: 10px 15px; }
        .bank-person-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed #eee; }
        .bank-person-row:last-child { border-bottom: none; }
        .person-name { color: #666; }
        .person-val { font-weight: 600; color: #333; }
        .person-me { color: var(--purple); font-weight: bold; }
        /* Loader */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--purple); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading-overlay"><div class="spinner"></div></div>

    <div class="container">
        <header>
            <h1>Painel Financeiro Cloud <i class="fas fa-cloud" style="color:#6c63ff; font-size: 20px;"></i></h1>
            <div class="month-filter-container">
                <i class="fas fa-calendar-alt" style="color:var(--purple)"></i>
                <label for="month-filter" style="font-size:12px; color:#555">Referência:</label>
                <input type="month" id="month-filter" onchange="updateScreen()">
            </div>
            <small style="color:#28a745; font-size:12px;" id="status-indicator">● Conectado ao Google</small>
        </header>

        <div class="dashboard-grid">
            <div class="card balance-card">
                <h3><i class="fas fa-wallet"></i> Saldo (Débito)</h3>
                <p id="wallet-balance" class="money">R$ 0.00</p>
                <small>Acumulado Geral</small>
            </div>
            <div class="card invoice-card">
                <h3><i class="fas fa-credit-card"></i> Fatura Mês</h3>
                <p id="invoice-total" class="money">R$ 0.00</p>
                <small>Referência Selecionada</small>
            </div>
        </div>

        <div class="main-content">
            <div class="column">
                <div class="box-clean">
                    <h3><i class="fas fa-users"></i> Pessoas</h3>
                    <div class="tags-container" id="users-list-tags"></div>
                    <div class="input-group-row">
                        <input type="text" id="new-user-name" placeholder="Adicionar Nome">
                        <button onclick="addUser()" class="btn-icon"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div class="box-clean">
                    <h3><i class="fas fa-university"></i> Bancos</h3>
                    <div class="tags-container" id="banks-list"></div>
                    <div class="input-group-row">
                        <input type="text" id="new-bank-name" placeholder="Novo Banco">
                        <button onclick="addBank()" class="btn-icon"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div class="box-clean">
                    <h3 id="form-title">Movimentação</h3>
                    <form id="transaction-form">
                        <input type="hidden" id="edit-transaction-id">
                        <div class="form-control">
                            <label>Descrição</label>
                            <input type="text" id="desc" placeholder="Ex: Mercado, Uber..." required>
                        </div>
                        <div class="form-control">
                            <label>Observação</label>
                            <textarea id="obs" rows="2" placeholder="Detalhes opcionais..."></textarea>
                        </div>
                        <div class="row-inputs">
                            <div class="form-control half">
                                <label>Valor (R$)</label>
                                <input type="text" id="amount" placeholder="0,00" required> 
                            </div>
                            <div class="form-control half">
                                <label>Data</label>
                                <input type="date" id="trans-date" required>
                            </div>
                        </div>
                        <div class="row-inputs">
                            <div class="form-control half">
                                <label>Banco</label>
                                <select id="bank-select"></select>
                            </div>
                            <div class="form-control half">
                                <label>Tipo</label>
                                <select id="trans-type">
                                    <option value="expense">Saída (-)</option>
                                    <option value="income">Entrada (+)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row-inputs">
                            <div class="form-control half">
                                <label>Parcelas</label>
                                <input type="number" id="installments" value="1" min="1" max="60">
                            </div>
                            <div class="form-control half">
                                <label>Quem?</label>
                                <select id="user-select" onchange="checkUserMethod()"></select>
                            </div>
                        </div>
                        <div class="form-control">
                            <label>Pagamento</label>
                            <div class="radio-group">
                                <input type="radio" id="method-debit" name="method" value="debit" checked>
                                <label for="method-debit" class="radio-label">Débito</label>
                                <input type="radio" id="method-credit" name="method" value="credit">
                                <label for="method-credit" class="radio-label">Cartão</label>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" id="btn-submit" class="btn-save">Salvar no Cloud</button>
                            <button type="button" id="btn-cancel" class="btn-cancel" onclick="cancelEdit()">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="column">
                <div class="box-clean">
                    <h3><i class="fas fa-file-invoice-dollar"></i> Fatura (Por Banco)</h3>
                    <ul id="invoice-split-list" class="list-users"></ul>
                </div>
                <div class="box-clean">
                    <h3>Extrato Mês</h3>
                    <ul id="transactions-list" class="list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Importa as funções necessárias do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ------------------------------------------------------------------
        // --- COLE SUA CONFIGURAÇÃO DO FIREBASE AQUI EMBAIXO ---
        // ------------------------------------------------------------------
        const firebaseConfig = {
          apiKey: "AIzaSyBaZMJ1wmsTXEQjmgiDtceUvzVHsfSslg0",
          authDomain: "financeiro-luique.firebaseapp.com",
          projectId: "financeiro-luique",
          storageBucket: "financeiro-luique.firebasestorage.app",
          messagingSenderId: "552706446904",
          appId: "1:552706446904:web:4fcc0bc31811b82e4938cd",
          measurementId: "G-RN7JXL13D5"
        };
        // ------------------------------------------------------------------

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Referência onde os dados serão salvos no banco (Pasta 'dados_henrique')
        const dbRef = ref(db, 'dados_henrique');

        // --- VARIÁVEIS GLOBAIS ---
        let users = [];
        let transactions = [];
        let banks = [];
        
        // Configurações Padrão
        const bankColors = {
            'Nubank': '#820ad1', 'Bradesco': '#cc092f', 'Itaú Uniclass': '#ec7000',
            'Mercado Pago': '#009ee3', 'Pão de Açúcar': '#005835', 'Azul Platinum': '#0f2660',
            'Azul Gold': '#1e40af', 'default': '#555555'
        };
        const bankDueDates = {
            'Bradesco': '08', 'Mercado Pago': '08', 'Itaú Uniclass': '10',
            'Nubank': '09', 'Azul Platinum': '15', 'Azul Gold': '17', 'Pão de Açúcar': '18'
        };
        const defaultBanks = Object.keys(bankColors).filter(b => b !== 'default');

        // Elementos DOM
        const elLoader = document.getElementById('loading-overlay');
        const elStatus = document.getElementById('status-indicator');
        const elWallet = document.getElementById('wallet-balance');
        const elInvoice = document.getElementById('invoice-total');
        const elList = document.getElementById('transactions-list');
        const elSplit = document.getElementById('invoice-split-list');
        const elUserSelect = document.getElementById('user-select');
        const elBankSelect = document.getElementById('bank-select');
        const elBanksList = document.getElementById('banks-list');
        const elUsersListTags = document.getElementById('users-list-tags');
        const elMonthFilter = document.getElementById('month-filter');
        const elTransDate = document.getElementById('trans-date');
        
        // Elementos Edição
        const elEditId = document.getElementById('edit-transaction-id');
        const elBtnSubmit = document.getElementById('btn-submit');
        const elBtnCancel = document.getElementById('btn-cancel');
        const elFormTitle = document.getElementById('form-title');
        const elInstallments = document.getElementById('installments');
        const elDesc = document.getElementById('desc');
        const elObs = document.getElementById('obs');
        const elAmount = document.getElementById('amount');

        // --- 1. CONEXÃO E LEITURA DO BANCO (Substitui LocalStorage) ---
        onValue(dbRef, (snapshot) => {
            const data = snapshot.val();
            
            if (data) {
                // Se tem dados no banco, carrega
                transactions = data.transactions || [];
                users = data.users || [];
                banks = data.banks || [];
            } else {
                // Se banco tá vazio (primeira vez), inicia padrões
                users = ['Henrique'];
                banks = defaultBanks;
                transactions = [];
                // Salva padrões iniciais
                saveDataToFirebase();
            }
            
            // Renderiza tela
            elLoader.style.display = 'none';
            initUI();
        }, (error) => {
            console.error(error);
            elStatus.innerText = "● Erro de Conexão";
            elStatus.style.color = "red";
        });

        // Função para salvar tudo no Firebase
        function saveDataToFirebase() {
            set(dbRef, {
                users: users,
                banks: banks,
                transactions: transactions
            }).catch((err) => {
                alert("Erro ao salvar: " + err.message);
            });
        }

        // --- 2. LÓGICA DE UI E FORMULÁRIOS ---
        function initUI() {
            // Garante Henrique
            if (!users.includes('Henrique')) {
                users.unshift('Henrique');
                saveDataToFirebase();
            }

            // Data filtro padrão (se não tiver definido)
            if (!elMonthFilter.value) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                elMonthFilter.value = `${year}-${month}`;
                elTransDate.value = `${year}-${month}-${day}`;
            }

            updateDropdowns();
            updateScreen();
        }

        // Salvar Transação
        document.getElementById('transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const descVal = elDesc.value;
            const obsVal = elObs.value;
            let amountStr = elAmount.value.replace(',', '.');
            const totalAmount = parseFloat(amountStr);
            const dateInput = elTransDate.value;
            const type = document.getElementById('trans-type').value;
            const user = document.getElementById('user-select').value;
            const bank = document.getElementById('bank-select').value;
            let method = document.getElementById('method-credit').checked ? 'credit' : 'debit';
            
            if (isNaN(totalAmount) || totalAmount <= 0) { alert("Valor inválido"); return; }
            if (!dateInput) { alert("Selecione uma data"); return; }

            const editId = elEditId.value;

            if (editId) {
                // EDIÇÃO
                const index = transactions.findIndex(t => t.id == editId);
                if (index !== -1) {
                    const dateObj = new Date(dateInput);
                    dateObj.setMinutes(dateObj.getMinutes() + dateObj.getTimezoneOffset());
                    
                    transactions[index].desc = descVal;
                    transactions[index].obs = obsVal;
                    transactions[index].amount = totalAmount;
                    transactions[index].date = dateInput;
                    transactions[index].displayDate = dateObj.toLocaleDateString('pt-BR');
                    transactions[index].type = type;
                    transactions[index].user = user;
                    transactions[index].bank = bank;
                    transactions[index].method = method;
                }
                cancelEdit();
            } else {
                // CRIAÇÃO + PARCELAS
                const installments = parseInt(elInstallments.value) || 1;
                const installmentValue = totalAmount / installments;
                const baseDate = new Date(dateInput); 
                const startYear = baseDate.getFullYear();
                const startMonth = baseDate.getMonth();
                const startDay = baseDate.getDate() + 1; 

                for (let i = 0; i < installments; i++) {
                    const date = new Date(startYear, startMonth + i, startDay);
                    const isoDate = date.toISOString().split('T')[0];
                    const ptDate = date.toLocaleDateString('pt-BR');
                    const descText = installments > 1 ? `${descVal} (${i+1}/${installments})` : descVal;

                    transactions.push({
                        id: Date.now() + i, 
                        desc: descText, obs: obsVal, amount: installmentValue, 
                        type, user, bank, method,
                        date: isoDate, displayDate: ptDate 
                    });
                }
                
                elDesc.value = ''; elObs.value = ''; elAmount.value = ''; elInstallments.value = '1';
            }

            saveDataToFirebase(); // Salva na Nuvem
        });

        // --- FUNÇÕES GLOBAIS (Disponíveis no window para o HTML chamar) ---
        
        window.updateScreen = function() {
            elList.innerHTML = ''; elSplit.innerHTML = '';
            let wallet = 0; let invoice = 0; 
            const selectedMonth = elMonthFilter.value; 
            let bankConsolidation = {};

            transactions.forEach(t => {
                if (t.type === 'income') wallet += t.amount;
                if (t.type === 'expense' && t.method === 'debit') wallet -= t.amount;
            });

            const filteredTransactions = transactions.filter(t => t.date.startsWith(selectedMonth));
            filteredTransactions.sort((a,b) => a.date.localeCompare(b.date));

            filteredTransactions.forEach(t => {
                const li = document.createElement('li');
                if(t.type === 'income') li.className = 'income';
                else if(t.method === 'credit') li.className = 'expense-credit';
                else li.className = 'expense-debit';
                
                const label = t.method === 'credit' ? '<span class="badge bg-credit">Crédito</span>' : (t.type === 'income' ? '' : '<span class="badge bg-debit">Débito</span>');
                const sign = t.type === 'expense' ? '-' : '+';
                const displayBank = t.bank ? t.bank : '-';
                const obsText = t.obs ? `<span class="obs-text"><i class="fas fa-info-circle"></i> ${t.obs}</span>` : '';

                li.innerHTML = `
                    <div style="flex:1">
                        <strong>${t.desc} ${label}</strong>
                        ${obsText}
                        <small style="color:#777">${t.user} | ${displayBank} | ${t.displayDate}</small>
                    </div>
                    <div style="display:flex;align-items:center;gap:5px;">
                        <span style="font-weight:bold; margin-right:5px;">${sign} R$ ${t.amount.toFixed(2)}</span>
                        <div class="btn-action-group">
                            <button class="btn-edit" onclick="editTrans(${t.id})"><i class="fas fa-pen"></i></button>
                            <button class="btn-delete" onclick="removeTrans(${t.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                elList.prepend(li); 

                if (t.type === 'expense' && t.method === 'credit') {
                    invoice += t.amount;
                    const bName = t.bank || 'Outros';
                    if (!bankConsolidation[bName]) bankConsolidation[bName] = { total: 0, users: {} };
                    bankConsolidation[bName].total += t.amount;
                    if (!bankConsolidation[bName].users[t.user]) bankConsolidation[bName].users[t.user] = 0;
                    bankConsolidation[bName].users[t.user] += t.amount;
                }
            });

            elWallet.innerText = `R$ ${wallet.toFixed(2)}`;
            elInvoice.innerText = `R$ ${invoice.toFixed(2)}`;

            for (const [bankName, data] of Object.entries(bankConsolidation)) {
                if (data.total > 0) {
                    const li = document.createElement('li');
                    li.className = 'bank-summary-item';
                    const bgColor = bankColors[bankName] || bankColors['default'];
                    const dueDate = bankDueDates[bankName] ? ` - Dia ${bankDueDates[bankName]}` : '';

                    let html = `<div class="bank-header" style="background-color: ${bgColor}">
                                    <span>${bankName}${dueDate}</span>
                                    <span>R$ ${data.total.toFixed(2)}</span>
                                </div>
                                <div class="bank-people-list">`;
                    for (const [person, val] of Object.entries(data.users)) {
                        const isMe = person === 'Henrique' ? 'person-me' : 'person-name';
                        html += `<div class="bank-person-row">
                                    <span class="${isMe}">${person}</span>
                                    <span class="person-val">R$ ${val.toFixed(2)}</span>
                                 </div>`;
                    }
                    html += `</div>`;
                    li.innerHTML = html;
                    elSplit.appendChild(li);
                }
            }
        };

        window.editTrans = function(id) {
            const t = transactions.find(x => x.id === id);
            if (!t) return;
            elEditId.value = t.id;
            elDesc.value = t.desc;
            elObs.value = t.obs || '';
            elAmount.value = t.amount;
            elTransDate.value = t.date;
            document.getElementById('bank-select').value = t.bank;
            document.getElementById('user-select').value = t.user;
            document.getElementById('trans-type').value = t.type;
            if (t.method === 'credit') document.getElementById('method-credit').checked = true;
            else document.getElementById('method-debit').checked = true;

            elFormTitle.innerText = "Editar";
            elBtnSubmit.innerText = "Atualizar";
            elBtnSubmit.style.background = "#f39c12";
            elBtnCancel.style.display = "block";
            elInstallments.value = 1;
            elInstallments.disabled = true;
            document.querySelector('.container').scrollIntoView({ behavior: 'smooth' });
        };

        window.cancelEdit = function() {
            elEditId.value = '';
            document.getElementById('transaction-form').reset();
            elInstallments.value = 1;
            elInstallments.disabled = false;
            elFormTitle.innerText = "Movimentação";
            elBtnSubmit.innerText = "Salvar no Cloud";
            elBtnSubmit.style.background = "var(--purple)";
            elBtnCancel.style.display = "none";
            const now = new Date();
            elTransDate.value = now.toISOString().split('T')[0];
        };

        window.checkUserMethod = function() {
            if(elUserSelect.value !== 'Henrique') document.getElementById('method-credit').checked = true;
        };

        window.addUser = function() {
            const name = document.getElementById('new-user-name').value.trim();
            if(name && !users.includes(name)) { users.push(name); saveDataToFirebase(); updateDropdowns(); document.getElementById('new-user-name').value = ''; }
        };

        window.editUser = function(oldName) {
            const newName = prompt("Editar nome de " + oldName + " para:", oldName);
            if (newName && newName.trim() !== "" && newName !== oldName) {
                const index = users.indexOf(oldName);
                if (index !== -1) {
                    users[index] = newName.trim();
                    transactions.forEach(t => { if (t.user === oldName) t.user = newName.trim(); });
                    saveDataToFirebase(); updateDropdowns(); updateScreen();
                }
            }
        };

        window.removeUser = function(name) {
            if (name === 'Henrique') { alert("Não pode excluir o dono!"); return; }
            if (confirm('Excluir ' + name + '?')) {
                users = users.filter(u => u !== name);
                saveDataToFirebase(); updateDropdowns();
            }
        };

        window.addBank = function() {
            const name = document.getElementById('new-bank-name').value.trim();
            if(name && !banks.includes(name)) { banks.push(name); saveDataToFirebase(); updateDropdowns(); document.getElementById('new-bank-name').value = ''; }
        };

        window.removeBank = function(name) { if(confirm('Excluir ' + name + '?')) { banks = banks.filter(b => b !== name); saveDataToFirebase(); updateDropdowns(); } };
        window.removeTrans = function(id) { if(confirm('Apagar?')) { transactions = transactions.filter(t => t.id !== id); saveDataToFirebase(); updateScreen(); } };

        function updateDropdowns() {
            elUserSelect.innerHTML = '';
            elUsersListTags.innerHTML = ''; 
            users.forEach(u => {
                const opt = document.createElement('option');
                opt.value = u; opt.innerText = u;
                elUserSelect.appendChild(opt);
                const div = document.createElement('div');
                div.className = 'tag';
                div.innerHTML = `<span onclick="editUser('${u}')">${u} <i class="fas fa-pen" style="font-size:10px; margin-left:5px; opacity:0.5"></i></span><span class="tag-delete" onclick="removeUser('${u}')">&times;</span>`;
                elUsersListTags.appendChild(div);
            });
            elBankSelect.innerHTML = '';
            elBanksList.innerHTML = '';
            banks.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b; opt.innerText = b;
                elBankSelect.appendChild(opt);
                const div = document.createElement('div');
                div.className = 'tag';
                const dotColor = bankColors[b] || '#ccc';
                div.innerHTML = `<span style="width:8px;height:8px;border-radius:50%;background:${dotColor};display:inline-block;margin-right:4px;"></span>${b} <span class="tag-delete" onclick="removeBank('${b}')">&times;</span>`;
                elBanksList.appendChild(div);
            });
        }
    </script>
</body>
</html>
